name: Docker Compose Management

on:
  push:
    branches: [ "master" ]  # è§¦å‘æ¡ä»¶ï¼šæ¨é€åˆ° master åˆ†æ”¯
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

jobs:
  manage_containers:
    runs-on: ubuntu-latest
    steps:
      - name: æ‰“å°ä¿¡æ¯ ğŸ‰
        run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."

      - name: æ‰“å°æ“ä½œç³»ç»Ÿä¿¡æ¯ ğŸ§
        run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"

      - name: æ‰“å°åˆ†æ”¯å’Œä»“åº“ä¿¡æ¯ ğŸ”
        run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: æ£€æŸ¥ä»“åº“ä»£ç  ğŸ‘ï¸
        uses: actions/checkout@v4

      - name: æ‰“å°ä»“åº“æ–‡ä»¶åˆ—è¡¨ ğŸ“¦
        run: ls ${{ github.workspace }}

      - name: æ‰“åŒ…ä»£ç æˆ ZIP æ–‡ä»¶ ğŸ“¦
        run: |
          zip -r code.zip . -x "*.git*"

      - name: æŸ¥çœ‹ zip æ–‡ä»¶ ğŸ“¦
        run: |
          ls

      - name: æ¨é€åˆ°å¤‡ä»½æœåŠ¡å™¨
        uses: SamKirkland/FTP-Deploy-Action@4.0.0
        with:
          local-dir: ./
          server: ${{ secrets.SERVER_SERVER }}
          username: ${{ secrets.SERVER_USERNAME }}
          password: ${{ secrets.SERVER_PASSWORD }}
          remote-dir: /opt/app/zip
          exclude: |
            .git
            node_modules
            .gitignore
            .env

      - name: æ‰“å°ä½œä¸šçŠ¶æ€ ğŸ
        run: echo "ğŸ This job's status is ${{ job.status }}."
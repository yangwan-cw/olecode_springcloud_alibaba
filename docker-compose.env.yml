version: '3.8'

services:
  mysql:
    image: mysql:8
    container_name: olecode_mysql
    environment:
      MYSQL_ROOT_PASSWORD: 9978@wzb  # MySQL root 用户的密码
    ports:
      - "3306:3306"  # 映射主机端口到容器端口
    volumes:
      - ./.mysql_data:/var/lib/mysql         # 持久化数据存储
      - ./mysql-init:/docker-entrypoint-initdb.d # 自动执行脚本
    restart: always
    networks:
      - common-networks # 指定网络

  redis:
    image: redis:6
    container_name: olecode_redis
    ports:
      - "6379:6379"  # 映射主机端口到容器端口
    networks:
      - common-networks # 指定网络
    volumes:
      - ./.redis-data:/data       # 持久化数据存储

  rabbitmq:
    image: rabbitmq:3.12.6-management
    container_name: yuoj-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
    ports:
      - "5672:5672"   # RabbitMQ 服务端口
      - "15672:15672" # RabbitMQ 管理面板端口
    volumes:
      - ./.rabbitmq-data:/var/lib/rabbitmq # 持久化数据存储
    networks:
      - common-networks

  nacos:
    image: nacos/nacos-server:v2.2.0-slim
    container_name: yuoj-nacos
    environment:
      MODE: standalone # 单节点模式启动
      PREFER_HOST_MODE: hostname # 支持 hostname
      TZ: Asia/Shanghai # 控制时区
    ports:
      - "8848:8848" # Nacos 服务端口
    volumes:
      - ./.nacos-data:/home/nacos/data # 持久化数据存储
    networks:
      - common-networks

networks:
  common-networks:
